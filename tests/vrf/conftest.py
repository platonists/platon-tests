from typing import List

import pytest
from platon_aide import Aide

# 将ABI中的bool值转为python的bool值
from platon_aide.contract import Contract

true = True
false = False

# 内置VRF合约的协调者地址
# coordinator_address = ''

# 待测试的consumer合约的abi和bin
consumer_abi = [{"inputs":[{"internalType":"address","name":"vrfCoordinator","type":"address"},{"internalType":"uint64","name":"subscriptionId","type":"uint64"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"address","name":"have","type":"address"},{"internalType":"address","name":"want","type":"address"}],"name":"OnlyCoordinatorCanFulfill","type":"error"},{"inputs":[],"name":"getRandomWords","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"requestId","type":"uint256"},{"internalType":"uint256[]","name":"randomWords","type":"uint256[]"}],"name":"rawFulfillRandomWords","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint32","name":"numWords","type":"uint32"}],"name":"requestRandomWords","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"s_last_randomWords","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"s_randomWords_length","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"s_requestId","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint32","name":"numWords","type":"uint32"}],"name":"syncRequestRandomWords","outputs":[],"stateMutability":"nonpayable","type":"function"}]
consumer_bin = '60a06040527fd89b2bf150e3b9e13446986e571fb9cab24b13cea0a43ea20a6049a85cc807cc6001556002805465ffffffffffff60401b19166c6400000064000000000000000017905534801561005557600080fd5b506040516106e13803806106e1833981016040819052610074916100ca565b6001600160a01b039091166080819052600080546001600160a01b031990811690921790556006805490911633179055600280546001600160401b039092166001600160401b031990921691909117905561011c565b600080604083850312156100dd57600080fd5b82516001600160a01b03811681146100f457600080fd5b60208401519092506001600160401b038116811461011157600080fd5b809150509250929050565b6080516105a361013e60003960008181610111015261015301526105a36000f3fe608060405234801561001057600080fd5b506004361061007d5760003560e01c8063ce10b1fb1161005b578063ce10b1fb146100c6578063e726f2e1146100e1578063e89e106a146100f4578063fe16c2cb146100fd57600080fd5b80631fe543e314610082578063560bf574146100975780635a320df1146100b3575b600080fd5b6100956100903660046103b9565b610106565b005b6100a060035481565b6040519081526020015b60405180910390f35b6100956100c136600461045b565b610192565b600354600454604080519283526020830191909152016100aa565b6100956100ef36600461045b565b610282565b6100a060055481565b6100a060045481565b336001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016146101845760405163073e64fd60e21b81523360048201526001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016602482015260440160405180910390fd5b61018e8282610339565b5050565b600080546001546002546040516349640f1d60e11b8152600481019290925267ffffffffffffffff81166024830152600160601b810461ffff166044830152600160401b900463ffffffff9081166064830152841660848201526001600160a01b03909116906392c81e3a9060a4016000604051808303816000875af1158015610220573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526102489190810190610488565b80516003819055909150819061026090600190610519565b815181106102705761027061053e565b60200260200101516004819055505050565b6000546001546002546040516305d3b1d360e41b8152600481019290925267ffffffffffffffff81166024830152600160601b810461ffff166044830152600160401b900463ffffffff9081166064830152831660848201526001600160a01b0390911690635d3b1d309060a4016020604051808303816000875af115801561030f573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103339190610554565b60055550565b80516003819055819061026090600190610519565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff8111828210171561038d5761038d61034e565b604052919050565b600067ffffffffffffffff8211156103af576103af61034e565b5060051b60200190565b600080604083850312156103cc57600080fd5b8235915060208084013567ffffffffffffffff8111156103eb57600080fd5b8401601f810186136103fc57600080fd5b803561040f61040a82610395565b610364565b81815260059190911b8201830190838101908883111561042e57600080fd5b928401925b8284101561044c57833582529284019290840190610433565b80955050505050509250929050565b60006020828403121561046d57600080fd5b813563ffffffff8116811461048157600080fd5b9392505050565b6000602080838503121561049b57600080fd5b825167ffffffffffffffff8111156104b257600080fd5b8301601f810185136104c357600080fd5b80516104d161040a82610395565b81815260059190911b820183019083810190878311156104f057600080fd5b928401925b8284101561050e578351825292840192908401906104f5565b979650505050505050565b60008282101561053957634e487b7160e01b600052601160045260246000fd5b500390565b634e487b7160e01b600052603260045260246000fd5b60006020828403121561056657600080fd5b505191905056fea26469706673582212201137b897fff1aeb52b3c57d26ba6b861fc9f69754cb4c54b44335a7e582bc37d64736f6c634300080d0033'


@pytest.fixture(scope='session')
def coordinator(aides: List[Aide]):
    """ 预部署coordinator合约，并返回合约对象
    """
    # 临时使用，待VRF上线后直接使用coordinator地址
    aide = aides[0]
    coordinator_abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"uint64","name":"subId","type":"uint64"},{"internalType":"address","name":"consumer","type":"address"}],"name":"InvalidConsumer","type":"error"},{"inputs":[{"internalType":"int256","name":"linkWei","type":"int256"}],"name":"InvalidLinkWeiPrice","type":"error"},{"inputs":[{"internalType":"uint32","name":"numWords","type":"uint32"},{"internalType":"uint256","name":"returnValueLength","type":"uint256"}],"name":"InvalidRandomWords","type":"error"},{"inputs":[{"internalType":"uint16","name":"have","type":"uint16"},{"internalType":"uint16","name":"min","type":"uint16"},{"internalType":"uint16","name":"max","type":"uint16"}],"name":"InvalidRequestConfirmations","type":"error"},{"inputs":[],"name":"InvalidSubscription","type":"error"},{"inputs":[{"internalType":"address","name":"proposedOwner","type":"address"}],"name":"MustBeRequestedOwner","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"MustBeSubOwner","type":"error"},{"inputs":[{"internalType":"uint32","name":"have","type":"uint32"},{"internalType":"uint32","name":"want","type":"uint32"}],"name":"NumWordsTooBig","type":"error"},{"inputs":[],"name":"PendingRequestExists","type":"error"},{"inputs":[],"name":"Reentrant","type":"error"},{"inputs":[],"name":"TooManyConsumers","type":"error"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint16","name":"minimumRequestConfirmations","type":"uint16"},{"indexed":false,"internalType":"uint32","name":"maxGasLimit","type":"uint32"},{"indexed":false,"internalType":"uint32","name":"stalenessSeconds","type":"uint32"},{"indexed":false,"internalType":"uint32","name":"gasAfterPaymentCalculation","type":"uint32"},{"indexed":false,"internalType":"int256","name":"fallbackWeiPerUnitLink","type":"int256"},{"components":[{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier1","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier2","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier3","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier4","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier5","type":"uint32"},{"internalType":"uint24","name":"reqsForTier2","type":"uint24"},{"internalType":"uint24","name":"reqsForTier3","type":"uint24"},{"internalType":"uint24","name":"reqsForTier4","type":"uint24"},{"internalType":"uint24","name":"reqsForTier5","type":"uint24"}],"indexed":false,"internalType":"struct VRFCoordinatorV2.FeeConfig","name":"feeConfig","type":"tuple"}],"name":"ConfigSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"OwnershipTransferRequested","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"requestId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"outputSeed","type":"uint256"},{"indexed":false,"internalType":"uint96","name":"payment","type":"uint96"},{"indexed":false,"internalType":"bool","name":"success","type":"bool"}],"name":"RandomWordsFulfilled","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"keyHash","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"requestId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"preSeed","type":"uint256"},{"indexed":true,"internalType":"uint64","name":"subId","type":"uint64"},{"indexed":false,"internalType":"uint16","name":"minimumRequestConfirmations","type":"uint16"},{"indexed":false,"internalType":"uint32","name":"callbackGasLimit","type":"uint32"},{"indexed":false,"internalType":"uint32","name":"numWords","type":"uint32"},{"indexed":true,"internalType":"address","name":"sender","type":"address"}],"name":"RandomWordsRequested","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"subId","type":"uint64"},{"indexed":false,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"SubscriptionCanceled","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"subId","type":"uint64"},{"indexed":false,"internalType":"address","name":"consumer","type":"address"}],"name":"SubscriptionConsumerAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"subId","type":"uint64"},{"indexed":false,"internalType":"address","name":"consumer","type":"address"}],"name":"SubscriptionConsumerRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"subId","type":"uint64"},{"indexed":false,"internalType":"address","name":"owner","type":"address"}],"name":"SubscriptionCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"subId","type":"uint64"},{"indexed":false,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"address","name":"to","type":"address"}],"name":"SubscriptionOwnerTransferRequested","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint64","name":"subId","type":"uint64"},{"indexed":false,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"address","name":"to","type":"address"}],"name":"SubscriptionOwnerTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"requestId","type":"uint256"},{"indexed":false,"internalType":"uint32","name":"numWords","type":"uint32"},{"indexed":false,"internalType":"uint256","name":"numRandomWords","type":"uint256"}],"name":"SyncRequestRandomWordsFulfilled","type":"event"},{"inputs":[],"name":"MAX_CONSUMERS","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_NUM_WORDS","outputs":[{"internalType":"uint32","name":"","type":"uint32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_REQUEST_CONFIRMATIONS","outputs":[{"internalType":"uint16","name":"","type":"uint16"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"acceptOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"subId","type":"uint64"}],"name":"acceptSubscriptionOwnerTransfer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"subId","type":"uint64"},{"internalType":"address","name":"consumer","type":"address"}],"name":"addConsumer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"subId","type":"uint64"},{"internalType":"address","name":"to","type":"address"}],"name":"cancelSubscription","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"createSubscription","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"requestId","type":"uint256"}],"name":"getCommitment","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getConfig","outputs":[{"internalType":"uint16","name":"minimumRequestConfirmations","type":"uint16"},{"internalType":"uint32","name":"maxGasLimit","type":"uint32"},{"internalType":"uint32","name":"stalenessSeconds","type":"uint32"},{"internalType":"uint32","name":"gasAfterPaymentCalculation","type":"uint32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getCurrentSubId","outputs":[{"internalType":"uint64","name":"","type":"uint64"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getFallbackWeiPerUnitLink","outputs":[{"internalType":"int256","name":"","type":"int256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getFeeConfig","outputs":[{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier1","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier2","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier3","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier4","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier5","type":"uint32"},{"internalType":"uint24","name":"reqsForTier2","type":"uint24"},{"internalType":"uint24","name":"reqsForTier3","type":"uint24"},{"internalType":"uint24","name":"reqsForTier4","type":"uint24"},{"internalType":"uint24","name":"reqsForTier5","type":"uint24"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getRequestConfig","outputs":[{"internalType":"uint16","name":"","type":"uint16"},{"internalType":"uint32","name":"","type":"uint32"},{"internalType":"bytes32[]","name":"","type":"bytes32[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"subId","type":"uint64"}],"name":"getSubscription","outputs":[{"internalType":"uint96","name":"balance","type":"uint96"},{"internalType":"uint64","name":"reqCount","type":"uint64"},{"internalType":"address","name":"owner","type":"address"},{"internalType":"address[]","name":"consumers","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256[2]","name":"publicKey","type":"uint256[2]"}],"name":"hashOfKey","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"pure","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"subId","type":"uint64"}],"name":"ownerCancelSubscription","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"subId","type":"uint64"}],"name":"pendingRequestExists","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint64","name":"subId","type":"uint64"},{"internalType":"address","name":"consumer","type":"address"}],"name":"removeConsumer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"keyHash","type":"bytes32"},{"internalType":"uint64","name":"subId","type":"uint64"},{"internalType":"uint16","name":"requestConfirmations","type":"uint16"},{"internalType":"uint32","name":"callbackGasLimit","type":"uint32"},{"internalType":"uint32","name":"numWords","type":"uint32"}],"name":"requestRandomWords","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint64","name":"subId","type":"uint64"},{"internalType":"address","name":"newOwner","type":"address"}],"name":"requestSubscriptionOwnerTransfer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint16","name":"minimumRequestConfirmations","type":"uint16"},{"internalType":"uint32","name":"maxGasLimit","type":"uint32"},{"internalType":"uint32","name":"stalenessSeconds","type":"uint32"},{"internalType":"uint32","name":"gasAfterPaymentCalculation","type":"uint32"},{"internalType":"int256","name":"fallbackWeiPerUnitLink","type":"int256"},{"components":[{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier1","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier2","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier3","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier4","type":"uint32"},{"internalType":"uint32","name":"fulfillmentFlatFeeLinkPPMTier5","type":"uint32"},{"internalType":"uint24","name":"reqsForTier2","type":"uint24"},{"internalType":"uint24","name":"reqsForTier3","type":"uint24"},{"internalType":"uint24","name":"reqsForTier4","type":"uint24"},{"internalType":"uint24","name":"reqsForTier5","type":"uint24"}],"internalType":"struct VRFCoordinatorV2.FeeConfig","name":"feeConfig","type":"tuple"}],"name":"setConfig","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"keyHash","type":"bytes32"},{"internalType":"uint64","name":"subId","type":"uint64"},{"internalType":"uint16","name":"requestConfirmations","type":"uint16"},{"internalType":"uint32","name":"callbackGasLimit","type":"uint32"},{"internalType":"uint32","name":"numWords","type":"uint32"}],"name":"syncRequestRandomWords","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"typeAndVersion","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"pure","type":"function"}]
    coordinator_bin = '6080604052600080546001600160c01b031916742030000000000000000000000000000000000000011790553480156200003857600080fd5b503380600081620000905760405162461bcd60e51b815260206004820152601860248201527f43616e6e6f7420736574206f776e657220746f207a65726f000000000000000060448201526064015b60405180910390fd5b600180546001600160a01b0319166001600160a01b0384811691909117909155811615620000c357620000c381620000cc565b50505062000178565b336001600160a01b03821603620001265760405162461bcd60e51b815260206004820152601760248201527f43616e6e6f74207472616e7366657220746f2073656c66000000000000000000604482015260640162000087565b600280546001600160a01b0319166001600160a01b03838116918217909255600154604051919216907fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127890600090a350565b61295680620001886000396000f3fe608060405234801561001057600080fd5b50600436106101a85760003560e01c806369bcdb7d116100f9578063a21a23e411610097578063caf70c4a11610071578063caf70c4a14610485578063d7ae1d3014610498578063e82ad7d4146104ab578063f2fde38b146104ce57600080fd5b8063a21a23e414610414578063a47c76961461041c578063c3f909d41461043f57600080fd5b806382359740116100d357806382359740146103b35780638da5cb5b146103c657806392c81e3a146103e15780639f87fad71461040157600080fd5b806369bcdb7d146103785780637341c10c1461039857806379ba5097146103ab57600080fd5b8063181f5a77116101665780634cb48a54116101405780634cb48a54146102b55780635d3b1d30146102c85780635fbbc0d2146102db57806364d51a2a1461037057600080fd5b8063181f5a7714610257578063356dac711461028f57806340d6bb821461029757600080fd5b8062012291146101ad57806302bcc5b6146101cd57806304c357cb146101e257806306bfa637146101f557806312b583491461021a57806315c48b841461023c575b600080fd5b6101b56104e1565b6040516101c4939291906121dd565b60405180910390f35b6101e06101db366004612258565b61055d565b005b6101e06101f0366004612291565b6105d4565b6006546001600160401b03165b6040516001600160401b0390911681526020016101c4565b600654600160401b90046001600160601b03165b6040519081526020016101c4565b61024460c881565b60405161ffff90911681526020016101c4565b60408051808201825260168152750565246436f6f7264696e61746f72563220312e302e360541b602082015290516101c491906122c4565b600a5461022e565b6102a06101f481565b60405163ffffffff90911681526020016101c4565b6101e06102c3366004612391565b61071f565b61022e6102d63660046124b0565b610975565b600c546040805163ffffffff8084168252640100000000840481166020830152600160401b8404811692820192909252600160601b830482166060820152600160801b8304909116608082015262ffffff600160a01b8304811660a0830152600160b81b8304811660c0830152600160d01b8304811660e0830152600160e81b909204909116610100820152610120016101c4565b610244606481565b61022e61038636600461250e565b60009081526009602052604090205490565b6101e06103a6366004612291565b610b95565b6101e0610d42565b6101e06103c1366004612258565b610df0565b6001546040516001600160a01b0390911681526020016101c4565b6103f46103ef3660046124b0565b610f4d565b6040516101c49190612562565b6101e061040f366004612291565b61113d565b610202611467565b61042f61042a366004612258565b611604565b6040516101c49493929190612575565b600b546040805161ffff8316815263ffffffff62010000840481166020830152600160381b8404811692820192909252600160581b9092041660608201526080016101c4565b61022e6104933660046125ef565b6116fe565b6101e06104a6366004612291565b61172e565b6104be6104b9366004612258565b611800565b60405190151581526020016101c4565b6101e06104dc36600461266e565b6119ab565b600b546008805460408051602080840282018101909252828152600094859460609461ffff8316946201000090930463ffffffff1693919283919083018282801561054b57602002820191906000526020600020905b815481526020019060010190808311610537575b50505050509050925092509250909192565b6105656119bc565b6001600160401b0381166000908152600460205260409020546001600160a01b03166105a457604051630fb532db60e11b815260040160405180910390fd5b6001600160401b0381166000908152600460205260409020546105d19082906001600160a01b0316611a11565b50565b6001600160401b03821660009081526004602052604090205482906001600160a01b03168061061657604051630fb532db60e11b815260040160405180910390fd5b336001600160a01b0382161461064f57604051636c51fda960e11b81526001600160a01b03821660048201526024015b60405180910390fd5b600b54600160301b900460ff161561067a5760405163769dd35360e11b815260040160405180910390fd5b6001600160401b0384166000908152600460205260409020600101546001600160a01b03848116911614610719576001600160401b03841660008181526004602090815260409182902060010180546001600160a01b0319166001600160a01b0388169081179091558251338152918201527f69436ea6df009049404f564eff6622cd00522b0bd6a89efd9e52a355c4a879be91015b60405180910390a25b50505050565b6107276119bc565b60c861ffff871611156107615760405163539c34bb60e11b815261ffff871660048201819052602482015260c86044820152606401610646565b60008213610785576040516321ea67b360e11b815260048101839052602401610646565b6040805160a0808201835261ffff891680835263ffffffff89811660208086018290526000868801528a831660608088018290528b85166080988901819052600b805465ffffffffffff191690971762010000909502949094176effffffffffffffffff0000000000001916600160381b90920263ffffffff60581b191691909117600160581b909302929092179093558651600c80549489015189890151938a0151978a0151968a015160c08b015160e08c01516101008d015195881667ffffffffffffffff199099169890981764010000000093881693909302929092176fffffffffffffffff00000000000000001916600160401b9587169590950263ffffffff60601b191694909417600160601b988616989098029790971766ffffffffffffff60801b1916600160801b969094169590950262ffffff60a01b191692909217600160a01b62ffffff928316021765ffffffffffff60b81b1916600160b81b9582169590950262ffffff60d01b191694909417600160d01b92851692909202919091176001600160e81b0316600160e81b9390911692909202919091178155600a84905590517fc21e3bd2e0b339d2848f0dd956947a88966c242c0c0c582a33137a5c1ceb5cb291610965918991899189918991899190612689565b60405180910390a1505050505050565b600b54600090600160301b900460ff16156109a35760405163769dd35360e11b815260040160405180910390fd5b6001600160401b0385166000908152600460205260409020546001600160a01b03166109e257604051630fb532db60e11b815260040160405180910390fd5b3360009081526003602090815260408083206001600160401b03808a16855292528220541690819003610a3957604051637800cff360e11b81526001600160401b0387166004820152336024820152604401610646565b6101f463ffffffff84161115610a72576040516311ce1afb60e21b815263ffffffff841660048201526101f46024820152604401610646565b6000610a7f82600161277b565b9050600080610a908a338b86611c5e565b9150915081438a898933604051602001610aaf969594939291906127a6565b60408051808303601f19018152828252805160209182012060008681526009835283902055848352820183905261ffff8a169082015263ffffffff80891660608301528716608082015233906001600160401b038b16908c907f63373d1c4696214b898952999c9aaec57dac1ee2723cec59bea6888f489a97729060a00160405180910390a43360009081526003602090815260408083206001600160401b038d8116855292528220805467ffffffffffffffff1916918616919091179055610b7787611cd8565b9050610b85838b8333611e2e565b50919a9950505050505050505050565b6001600160401b03821660009081526004602052604090205482906001600160a01b031680610bd757604051630fb532db60e11b815260040160405180910390fd5b336001600160a01b03821614610c0b57604051636c51fda960e11b81526001600160a01b0382166004820152602401610646565b600b54600160301b900460ff1615610c365760405163769dd35360e11b815260040160405180910390fd5b6001600160401b03841660009081526004602052604090206002015460631901610c73576040516305a48e0f60e01b815260040160405180910390fd5b6001600160a01b03831660009081526003602090815260408083206001600160401b0380891685529252822054169003610719576001600160a01b03831660008181526003602090815260408083206001600160401b038916808552908352818420805467ffffffffffffffff19166001908117909155600484528285206002018054918201815585529383902090930180546001600160a01b031916851790555192835290917f43dc749a04ac8fb825cbd514f7c0e13f13bc6f2ee66043b76629d51776cff8e09101610710565b6002546001600160a01b03163314610d955760405162461bcd60e51b815260206004820152601660248201527526bab9ba10313290383937b837b9b2b21037bbb732b960511b6044820152606401610646565b600180546001600160a01b0319808216339081179093556002805490911690556040516001600160a01b03909116919082907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e090600090a350565b600b54600160301b900460ff1615610e1b5760405163769dd35360e11b815260040160405180910390fd5b6001600160401b0381166000908152600460205260409020546001600160a01b0316610e5a57604051630fb532db60e11b815260040160405180910390fd5b6001600160401b0381166000908152600460205260409020600101546001600160a01b03163314610ec8576001600160401b03811660009081526004602081905260409182902060010154915163d084e97560e01b81526001600160a01b0390921690820152602401610646565b6001600160401b0381166000818152600460209081526040918290208054336001600160a01b0319808316821784556001909301805490931690925583516001600160a01b03909116808252928101919091529092917f6f1dc65165ffffedfd8e507b4a0f1fcfdada045ed11f6c26ba27cedfe87802f0910160405180910390a25050565b600b54606090600160301b900460ff1615610f7b5760405163769dd35360e11b815260040160405180910390fd5b6001600160401b0385166000908152600460205260409020546001600160a01b0316610fba57604051630fb532db60e11b815260040160405180910390fd5b3360009081526003602090815260408083206001600160401b03808a1685529252822054169081900361101157604051637800cff360e11b81526001600160401b0387166004820152336024820152604401610646565b6101f463ffffffff8416111561104a576040516311ce1afb60e21b815263ffffffff841660048201526101f46024820152604401610646565b600061105782600161277b565b9050600061106789338a85611c5e565b509050804389888833604051602001611085969594939291906127a6565b60408051808303601f19018152918152815160209283012060008481526009845282812091909155338152600383528181206001600160401b038c811683529352908120805467ffffffffffffffff1916928516929092179091556110e986611cd8565b80516040805163ffffffff8a168152602081019290925291925083917f2ed6c361af14905e187c1f153e8558eb623c719b79285486514ef723853b672b910160405180910390a29998505050505050505050565b6001600160401b03821660009081526004602052604090205482906001600160a01b03168061117f57604051630fb532db60e11b815260040160405180910390fd5b336001600160a01b038216146111b357604051636c51fda960e11b81526001600160a01b0382166004820152602401610646565b600b54600160301b900460ff16156111de5760405163769dd35360e11b815260040160405180910390fd5b6001600160a01b03831660009081526003602090815260408083206001600160401b038089168552925282205416900361124557604051637800cff360e11b81526001600160401b03851660048201526001600160a01b0384166024820152604401610646565b6001600160401b0384166000908152600460209081526040808320600201805482518185028101850190935280835291929091908301828280156112b257602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311611294575b505050505090506000600182516112c991906127e9565b905060005b82518110156113ef57856001600160a01b03168382815181106112f3576112f3612800565b60200260200101516001600160a01b0316036113dd57600083838151811061131d5761131d612800565b6020026020010151905080600460008a6001600160401b03166001600160401b03168152602001908152602001600020600201838154811061136157611361612800565b600091825260208083209190910180546001600160a01b0319166001600160a01b0394909416939093179092556001600160401b038a1681526004909152604090206002018054806113b5576113b5612816565b600082815260209020810160001990810180546001600160a01b0319169055019055506113ef565b806113e78161282c565b9150506112ce565b506001600160a01b03851660008181526003602090815260408083206001600160401b038b1680855290835292819020805467ffffffffffffffff191690555192835290917f182bff9831466789164ca77075fffd84916d35a8180ba73c27e45634549b445b910160405180910390a2505050505050565b600b54600090600160301b900460ff16156114955760405163769dd35360e11b815260040160405180910390fd5b600680546001600160401b03169060006114ae83612845565b82546101009290920a6001600160401b03818102199093169183160217909155600654169050600080604051908082528060200260200182016040528015611500578160200160208202803683370190505b50604080518082018252600080825260208083018281526001600160401b03888116808552600584528685209551865493516001600160601b039091166001600160a01b031994851617600160601b919093160291909117909455845160608101865233815280830184815281870188815295855260048452959093208351815483166001600160a01b03918216178255955160018201805490931696169590951790559151805194955090936115bd9260028501920190612149565b50506040513381526001600160401b03841691507f464722b4166576d3dcbba877b999bc35cf911f4eaf434b7eba68fa113951d0bf9060200160405180910390a250905090565b6001600160401b038116600090815260046020526040812054819081906060906001600160a01b031661164a57604051630fb532db60e11b815260040160405180910390fd5b6001600160401b0380861660009081526005602090815260408083205460048352928190208054600290910180548351818602810186019094528084526001600160601b03861696600160601b909604909516946001600160a01b039092169390929183918301828280156116e857602002820191906000526020600020905b81546001600160a01b031681526001909101906020018083116116ca575b5050505050905093509350935093509193509193565b600081604051602001611711919061286b565b604051602081830303815290604052805190602001209050919050565b6001600160401b03821660009081526004602052604090205482906001600160a01b03168061177057604051630fb532db60e11b815260040160405180910390fd5b336001600160a01b038216146117a457604051636c51fda960e11b81526001600160a01b0382166004820152602401610646565b600b54600160301b900460ff16156117cf5760405163769dd35360e11b815260040160405180910390fd5b6117d884611800565b156117f657604051631685ecdd60e31b815260040160405180910390fd5b6107198484611a11565b6001600160401b0381166000908152600460209081526040808320815160608101835281546001600160a01b039081168252600183015416818501526002820180548451818702810187018652818152879693958601939092919083018282801561189457602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311611876575b505050505081525050905060005b8160400151518110156119a15760005b60085481101561198e576000611957600883815481106118d4576118d4612800565b9060005260206000200154856040015185815181106118f5576118f5612800565b602002602001015188600360008960400151898151811061191857611918612800565b6020908102919091018101516001600160a01b0316825281810192909252604090810160009081206001600160401b03808f1683529352205416611c5e565b506000818152600960205260409020549091501561197b5750600195945050505050565b50806119868161282c565b9150506118b2565b50806119998161282c565b9150506118a2565b5060009392505050565b6119b36119bc565b6105d181611fb4565b6001546001600160a01b03163314611a0f5760405162461bcd60e51b815260206004820152601660248201527527b7363c9031b0b63630b1363290313c9037bbb732b960511b6044820152606401610646565b565b600b54600160301b900460ff1615611a3c5760405163769dd35360e11b815260040160405180910390fd5b6001600160401b0382166000908152600460209081526040808320815160608101835281546001600160a01b03908116825260018301541681850152600282018054845181870281018701865281815292959394860193830182828015611acc57602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311611aae575b505050919092525050506001600160401b0380851660009081526005602090815260408083208151808301909252546001600160601b038116808352600160601b909104909416918101919091529293505b836040015151811015611b9f576003600085604001518381518110611b4557611b45612800565b6020908102919091018101516001600160a01b0316825281810192909252604090810160009081206001600160401b038a1682529092529020805467ffffffffffffffff1916905580611b978161282c565b915050611b1e565b506001600160401b038516600090815260046020526040812080546001600160a01b03199081168255600182018054909116905590611be160028301826121ae565b50506001600160401b03851660008181526005602090815260409182902080546001600160a01b031916905581516001600160a01b03881681526001600160601b038516918101919091527fe8ed5b475a5b5987aa9165e8731bb78043f39eee32ec5a1169a89e27fcd49815910160405180910390a25050505050565b6040805160208082018790526001600160a01b0395909516818301526001600160401b039384166060820152919092166080808301919091528251808303909101815260a08201835280519084012060c082019490945260e080820185905282518083039091018152610100909101909152805191012091565b6040805163ffffffff831660208201526060916000910160408051601f198184030181529190526000805491925090611d1b9083906001600160a01b031661205e565b805160005491925090611d3b90600160a01b900463ffffffff168661289c565b63ffffffff1614611d7157805160405163b6aa521160e01b815263ffffffff861660048201526024810191909152604401610646565b60008463ffffffff166001600160401b03811115611d9157611d9161233f565b604051908082528060200260200182016040528015611dba578160200160208202803683370190505b50905060005b8563ffffffff16811015611e255760008054611de990600160a01b900463ffffffff16836128c8565b9050611df584826120ca565b838381518110611e0757611e07612800565b60209081029190910101525080611e1d8161282c565b915050611dc0565b50949350505050565b600b54600090600160301b900460ff1615611e5c5760405163769dd35360e11b815260040160405180910390fd5b600085815260096020526040808220829055518190631fe543e360e01b90611e8a90899088906024016128e7565b60408051601f198184030181529190526020810180516001600160e01b03166001600160e01b031990931692909217909152600b805466ff0000000000001916600160301b17905590506000611ee08583612127565b600b805466ff000000000000191690556001600160401b03808916600090815260056020526040902080549293506001929091600c91611f29918591600160601b90041661277b565b92506101000a8154816001600160401b0302191690836001600160401b03160217905550877f7dffc5ae5ee4e2e4df1651cf6ad329a73cebdb728f37ea0187b9b17e036756e460008084604051611f9e939291909283526001600160601b039190911660208301521515604082015260600190565b60405180910390a2506000979650505050505050565b336001600160a01b0382160361200c5760405162461bcd60e51b815260206004820152601760248201527f43616e6e6f74207472616e7366657220746f2073656c660000000000000000006044820152606401610646565b600280546001600160a01b0319166001600160a01b03838116918217909255600154604051919216907fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127890600090a350565b815160609060008281808460208901885af4503d9150816001600160401b0381111561208c5761208c61233f565b6040519080825280601f01601f1916602001820160405280156120b6576020820181803683370190505b5090503d6000602083013e95945050505050565b60006120d7826020612908565b8351101561211e5760405162461bcd60e51b8152602060048201526014602482015273736c6963696e67206f7574206f662072616e676560601b6044820152606401610646565b50016020015190565b6000823b61213457600080fd5b6000808351602085016000875af19392505050565b82805482825590600052602060002090810192821561219e579160200282015b8281111561219e57825182546001600160a01b0319166001600160a01b03909116178255602090920191600190910190612169565b506121aa9291506121c8565b5090565b50805460008255906000526020600020908101906105d191905b5b808211156121aa57600081556001016121c9565b60006060820161ffff86168352602063ffffffff86168185015260606040850152818551808452608086019150828701935060005b8181101561222e57845183529383019391830191600101612212565b509098975050505050505050565b80356001600160401b038116811461225357600080fd5b919050565b60006020828403121561226a57600080fd5b6122738261223c565b9392505050565b80356001600160a01b038116811461225357600080fd5b600080604083850312156122a457600080fd5b6122ad8361223c565b91506122bb6020840161227a565b90509250929050565b600060208083528351808285015260005b818110156122f1578581018301518582016040015282016122d5565b81811115612303576000604083870101525b50601f01601f1916929092016040019392505050565b803561ffff8116811461225357600080fd5b803563ffffffff8116811461225357600080fd5b634e487b7160e01b600052604160045260246000fd5b60405161012081016001600160401b03811182821017156123785761237861233f565b60405290565b803562ffffff8116811461225357600080fd5b6000806000806000808688036101c08112156123ac57600080fd5b6123b588612319565b96506123c36020890161232b565b95506123d16040890161232b565b94506123df6060890161232b565b93506080880135925061012080609f19830112156123fc57600080fd5b612404612355565b915061241260a08a0161232b565b825261242060c08a0161232b565b602083015261243160e08a0161232b565b6040830152610100612444818b0161232b565b6060840152612454828b0161232b565b60808401526124666101408b0161237e565b60a08401526124786101608b0161237e565b60c084015261248a6101808b0161237e565b60e084015261249c6101a08b0161237e565b818401525050809150509295509295509295565b600080600080600060a086880312156124c857600080fd5b853594506124d86020870161223c565b93506124e660408701612319565b92506124f46060870161232b565b91506125026080870161232b565b90509295509295909350565b60006020828403121561252057600080fd5b5035919050565b600081518084526020808501945080840160005b838110156125575781518752958201959082019060010161253b565b509495945050505050565b6020815260006122736020830184612527565b6000608082016001600160601b038716835260206001600160401b0387168185015260018060a01b0380871660408601526080606086015282865180855260a087019150838801945060005b818110156125df5785518416835294840194918401916001016125c1565b50909a9950505050505050505050565b60006040828403121561260157600080fd5b82601f83011261261057600080fd5b604051604081018181106001600160401b03821117156126325761263261233f565b806040525080604084018581111561264957600080fd5b845b8181101561266357803583526020928301920161264b565b509195945050505050565b60006020828403121561268057600080fd5b6122738261227a565b61ffff8716815263ffffffff86811660208301528581166040830152848116606083015260808201849052825480821660a08401526101c0830191906126dc60c08501838360201c1663ffffffff169052565b6126f360e08501838360401c1663ffffffff169052565b61270b6101008501838360601c1663ffffffff169052565b6127236101208501838360801c1663ffffffff169052565b62ffffff60a082901c811661014086015260b882901c811661016086015260d082901c1661018085015260e81c6101a090930192909252979650505050505050565b634e487b7160e01b600052601160045260246000fd5b60006001600160401b0380831681851680830382111561279d5761279d612765565b01949350505050565b95865260208601949094526001600160401b0392909216604085015263ffffffff90811660608501521660808301526001600160a01b031660a082015260c00190565b6000828210156127fb576127fb612765565b500390565b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052603160045260246000fd5b60006001820161283e5761283e612765565b5060010190565b60006001600160401b0380831681810361286157612861612765565b6001019392505050565b60408101818360005b6002811015612893578151835260209283019290910190600101612874565b50505092915050565b600063ffffffff808316818516818304811182151516156128bf576128bf612765565b02949350505050565b60008160001904831182151516156128e2576128e2612765565b500290565b8281526040602082015260006129006040830184612527565b949350505050565b6000821982111561291b5761291b612765565b50019056fea2646970667358221220466ddcf9a944697c6f683a781a580273a344a39e106fa1ef72a0af26f499deef64736f6c634300080d0033'

    aide.contract.deploy(coordinator_abi, coordinator_bin)
    return aide.contract


@pytest.fixture
def consumer(aide: Aide, coordinator: Contract):
    """ 预部署consumer合约，并返回合约对象
    """
    res = coordinator.createSubscription()
    event = coordinator.SubscriptionCreated(res)
    sub_id = event['']
    aide.contract.deploy(consumer_abi, consumer_bin, vrfCoordinator=coordinator.address, subscriptionId=sub_id)
    coordinator.addConsumer(sub_id, aide.contract.address)

    return aide.contract

